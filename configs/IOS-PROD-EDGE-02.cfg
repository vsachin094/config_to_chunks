hostname Enterprise-Core-Router
!
enable secret 5 $1$abc$hashedenablepassword
!
username admin privilege 15 secret 5 $1$def$hashedadminpass
!
no service pad
service tcp-keepalives-in
service tcp-keepalives-out
ip domain-name example.com
crypto key generate rsa modulus 2048
!
no ip source-route
no ip gratuitous-arps
ip icmp error-interval 0 0 50
no ip identd
ipv6 io icmp redirect
no service dhcp
!
logging buffered 4096000 debugging
logging console critical
logging trap debugging
logging source-interface Loopback0
logging host 192.168.1.100
!
snmp-server group SNMPGroup v3 priv
snmp-server user MonitorUser SNMPGroup v3 auth sha AuthPass123 priv aes 128 PrivPass123
snmp-server host 192.168.1.100 version 3 priv MonitorUser
snmp-server enable traps bgp
snmp-server enable traps ospf
!
ntp server 192.168.30.10 prefer
ntp server 192.168.30.11
ntp authenticate
ntp authentication-key 1 md5 NtpKey123
ntp trusted-key 1
!
banner motd ^C
*** WARNING: Unauthorized access strictly prohibited! ***
All activities logged and monitored.
^C
banner login ^C
Authorized access only. Disconnect IMMEDIATELY if unauthorized.
^C
!
aaa new-model
aaa authentication login default local
aaa authorization exec default local
aaa authorization commands 15 default local
!
line con 0
 login local
 transport input none
line vty 0 4
 login local
 transport input ssh
 access-class VTY-ACL in
!
vlan 10
 name Data
vlan 20
 name Voice
vlan 30
 name Management
vlan 40
 name Guest
!
interface vlan 10
 ip address 10.10.10.1 255.255.255.0
 ip ospf authentication message-digest
 ip ospf message-digest-key 1 md5 OspfKey123
 standby 1 ip 10.10.10.254
 standby 1 priority 110
 standby 1 preempt
 standby 1 authentication md5 HsrpKey123
 ip access-group VLAN10-ACL in
!
interface vlan 20
 ip address 10.20.20.1 255.255.255.0
!
interface vlan 30
 ip address 192.168.30.1 255.255.255.0
!
interface vlan 40
 ip address 172.16.40.1 255.255.255.0
 ip access-group Guest-ACL in
!
interface Loopback0
 ip address 1.1.1.1 255.255.255.255
!
interface Port-channel1
 description Trunk to Access-SW1
 switchport mode trunk
 switchport trunk allowed vlan 10,20,30
 switchport trunk native vlan 30
 spanning-tree portfast trunk
 service-policy output ENTERPRISE-QOS
!
interface range GigabitEthernet0/1 - 4
 switchport mode trunk
 switchport trunk allowed vlan 10,20,30
 switchport trunk native vlan 30
 channel-group 1 mode active
!
interface Port-channel2
 description Trunk to Dist-SW1
 switchport mode trunk
 switchport trunk allowed vlan 10,20,40
 switchport trunk native vlan 30
 ip access-group TRUNK-ACL in
 service-policy output ENTERPRISE-QOS
!
interface range GigabitEthernet0/5 - 8
 switchport mode trunk
 switchport trunk allowed vlan 10,20,40
 switchport trunk native vlan 30
 channel-group 2 mode active
!
interface GigabitEthernet1/0
 description WAN-Uplink1
 ip address 203.0.113.1 255.255.255.252
 ip access-group WAN-IN-ACL in
 ip access-group WAN-OUT-ACL out
 ip flow ingress
 ip flow egress
 load-interval 30
 no shutdown
!
interface GigabitEthernet1/1
 description WAN-Uplink2
 ip address 198.51.100.1 255.255.255.252
 ip access-group WAN-IN-ACL in
 ip access-group WAN-OUT-ACL out
 ip flow ingress
 load-interval 30
 no shutdown
!
interface range TenGigabitEthernet0/1 - 2
 description High-Speed to Core
 ip address 172.16.0.1 255.255.255.254
 negotiation auto
 mtu 9216
 service-policy output ENTERPRISE-QOS
 no shutdown
!
spanning-tree mode rapid-pvst
spanning-tree portfast default
spanning-tree portfast bpduguard default
spanning-tree extend system-id
spanning-tree vlan 10,20,30,40 priority 4096
!
ip access-list extended VLAN10-ACL
 remark Protect Data VLAN
 deny ip 10.10.20.0 0.0.0.255 any log
 permit ip any any
!
ip access-list extended Guest-ACL
 remark Guest Internet Only
 permit tcp 172.16.40.0 0.0.0.255 any eq www
 permit tcp 172.16.40.0 0.0.0.255 any eq 443
 deny ip any any log
!
ip access-list extended TRUNK-ACL
 remark Trunk protection
 permit ip 10.0.0.0 0.255.255.255 any
 deny ip any any log-input
!
ip access-list extended WAN-IN-ACL
 remark WAN Inbound
 permit tcp any any eq 443
 permit icmp any any echo-reply
 deny ip any any log
!
ip access-list extended WAN-OUT-ACL
 remark WAN Outbound
 permit ip any any
!
ip access-list standard VTY-ACL
 remark VTY Management Access
 permit 192.168.30.0 0.0.0.255
 deny any log
!
ip access-list extended INFRA-ACL
 permit icmp host 192.168.30.10 any echo
 permit tcp host 192.168.30.10 any eq 22
 deny ip any any log-input
!
ip access-list extended CRITICAL
 permit tcp any any eq bgp
 permit ospf any any
!
router ospf 1
 router-id 1.1.1.1
 area 0 authentication message-digest
 network 10.10.10.0 0.0.0.255 area 0
 network 10.20.20.0 0.0.0.255 area 0
 network 192.168.30.0 0.0.0.255 area 0
 network 172.16.40.0 0.0.0.255 area 0
 max-lsa 12000
 max-metric router-lsa on-startup 3000
!
router bgp 65001
 bgp router-id 1.1.1.1
 bgp log-neighbor-changes
 neighbor 203.0.113.2 remote-as 65002
 neighbor 203.0.113.2 update-source GigabitEthernet1/0
 neighbor 203.0.113.2 password Bgppass123
 address-family ipv4
  network 10.0.0.0 mask 255.0.0.0
  neighbor 203.0.113.2 activate
  neighbor 203.0.113.2 soft-reconfiguration inbound
 exit-address-family
!
class-map match-any VOICE
 match dscp ef
class-map match-any VIDEO
 match dscp af41
class-map match-any COPP-CRITICAL
 match access-group name CRITICAL
class-map match-any COPP-SSH
 match access-group name SSH-ACL
!
policy-map ENTERPRISE-QOS
 class VOICE
  priority percent 30
 class VIDEO
  bandwidth percent 20
  random-detect dscp af41
 class class-default
  bandwidth percent 50
  fair-queue
!
policy-map COPP-POLICY
 class COPP-CRITICAL
  police rate 100 pps burst 100 packets conform-action transmit exceed-action drop
 class COPP-SSH
  police rate 50 pps burst 50 packets conform-action transmit exceed-action drop
 class class-default
  police rate 200 pps burst 200 packets conform-action transmit exceed-action drop
!
ip access-list extended SSH-ACL
 permit tcp 192.168.30.0 0.0.0.255 any eq 22
!
control-plane host
 management-interface GigabitEthernet1/0 allow ssh snmp https
 management-interface vlan 30 allow ssh snmp https
control-plane
 service-policy input COPP-POLICY
!
ip flow-export version 9
ip flow-export destination 192.168.1.100 9996
ip flow-cache timeout active 15
!
ip sla 1
 icmp-echo 8.8.8.8 source-interface Loopback0
 frequency 10
ip sla schedule 1 life forever start-time now
!
event manager applet CPU_HIGH
 event syslog pattern "CPU.*utilization.*over 80"
 action 1.0 syslog msg "High CPU detected - Alert Admin"
 action 2.0 cli command "enable"
 action 3.0 cli command "show processes cpu sorted | redirect bootflash:cpu_high.txt"
 action 4.0 cli command "copy bootflash:cpu_high.txt tftp://192.168.30.10/"
!
archive
 log config
  notify syslog
 path flash:configs/${SYSDATE}-config
 write-memory
 time-period 1440
!
end
