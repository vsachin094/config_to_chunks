hostname XR-PROD-EDGE-01

! =============================
! Global System Settings
! =============================
domain name example.net
domain lookup disable
clock timezone IST 5 30
service timestamps log datetime localtime
service password-encryption

! =============================
! Users & AAA
! =============================
username admin
 group root-lr
 secret 10 $6$examplehashedpassword

aaa group server tacacs+ TACACS-SERVERS
 server-private 10.10.10.10 key 7 070C285F4D06
 server-private 10.10.10.11 key 7 070C285F4D06
 timeout 5

aaa authentication login default group TACACS-SERVERS local
aaa authorization exec default group TACACS-SERVERS local
aaa authorization commands default group TACACS-SERVERS local
aaa accounting exec default start-stop group TACACS-SERVERS

! =============================
! VRFs
! =============================
vrf MGMT
 address-family ipv4 unicast
 !

vrf CUST-A
 address-family ipv4 unicast
 !

vrf CUST-B
 address-family ipv4 unicast
 !

! =============================
! Management Interface
! =============================
interface MgmtEth0/RP0/CPU0/0
 description OOB Management
 vrf MGMT
 ipv4 address 192.168.10.10 255.255.255.0
 no shutdown

! =============================
! Loopbacks
! =============================
interface Loopback0
 description Router-ID
 ipv4 address 10.255.255.1 255.255.255.255

interface Loopback100
 description Services Loopback
 ipv4 address 10.255.255.100 255.255.255.255

! =============================
! Core & Access Interfaces
! =============================
interface TenGigE0/0/0/0
 description Core-Uplink-ISP1
 mtu 9216
 ipv4 address 172.16.1.2 255.255.255.252
 no shutdown

interface TenGigE0/0/0/1
 description Core-Uplink-ISP2
 mtu 9216
 ipv4 address 172.16.2.2 255.255.255.252
 no shutdown

interface TenGigE0/0/0/2
 description Customer-A-Access
 vrf CUST-A
 ipv4 address 192.168.101.1 255.255.255.0
 no shutdown

interface TenGigE0/0/0/3
 description Customer-B-Access
 vrf CUST-B
 ipv4 address 192.168.102.1 255.255.255.0
 no shutdown

! =============================
! Subinterfaces
! =============================
interface TenGigE0/0/0/4.100
 description VLAN100-CUST-A
 encapsulation dot1q 100
 vrf CUST-A
 ipv4 address 10.10.100.1 255.255.255.0

interface TenGigE0/0/0/4.200
 description VLAN200-CUST-B
 encapsulation dot1q 200
 vrf CUST-B
 ipv4 address 10.10.200.1 255.255.255.0

! =============================
! OSPF – Core IGP
! =============================
router ospf 100
 router-id 10.255.255.1
 area 0
  interface Loopback0
   passive enable
  !
  interface TenGigE0/0/0/0
   network point-to-point
  !
  interface TenGigE0/0/0/1
   network point-to-point

! =============================
! BGP – Internet + VRFs
! =============================
router bgp 65001
 bgp router-id 10.255.255.1

 address-family ipv4 unicast
  network 10.255.255.1/32
 !

 neighbor 172.16.1.1
  remote-as 65010
  description ISP-PRIMARY
  address-family ipv4 unicast
   route-policy ISP-IN in
   route-policy ISP-OUT out
 !

 neighbor 172.16.2.1
  remote-as 65020
  description ISP-BACKUP
  address-family ipv4 unicast
   route-policy ISP-IN in
   route-policy ISP-OUT out
 !

 vrf CUST-A
  rd 65001:100
  address-family ipv4 unicast
   network 192.168.101.0/24
  !
  neighbor 10.10.100.2
   remote-as 65100
   address-family ipv4 unicast
 !

 vrf CUST-B
  rd 65001:200
  address-family ipv4 unicast
   network 192.168.102.0/24
 !

! =============================
! Route Policies
! =============================
route-policy ISP-IN
 pass
end-policy

route-policy ISP-OUT
 if destination in (10.255.255.0/24) then
  pass
 else
  drop
 endif
end-policy

! =============================
! QoS
! =============================
policy-map QOS-CUST
 class class-default
  bandwidth percent 50
 !

interface TenGigE0/0/0/2
 service-policy output QOS-CUST

! =============================
! NTP
! =============================
ntp
 server 192.168.100.10 prefer
 server 192.168.100.11

! =============================
! Syslog
! =============================
logging 192.168.200.10 vrf MGMT severity informational
logging buffered 200000

! =============================
! SNMP
! =============================
snmp-server community PROD-RO RO
snmp-server location DC-Bangalore
snmp-server contact noc@example.net

! =============================
! Telemetry (gNMI / MDT)
! =============================
telemetry model-driven
 destination-group PROMETHEUS
  address-family ipv4 192.168.50.10 port 57000
 !
 sensor-group INTERFACES
  sensor-path Cisco-IOS-XR-ifmgr-oper:interface-properties/data-nodes/interface
 !
 subscription IF-SUB
  sensor-group-id INTERFACES sample-interval 30000
  destination-id PROMETHEUS
 !

! =============================
! SSH Hardening
! =============================
ssh server v2
ssh timeout 60
ssh authentication-retries 3

! =============================
! Control Plane Protection
! =============================
control-plane
 management-plane
  inband
   interface all
    allow ssh
    allow snmp

! =============================
! Commit
! =============================
commit
