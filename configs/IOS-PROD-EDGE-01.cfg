!
! =============================
! System Identity
! =============================
hostname IOS-PROD-EDGE-01
!
ip domain-name example.net
ip domain-lookup
!
clock timezone IST 5 30
service timestamps debug datetime localtime
service timestamps log datetime localtime
service password-encryption
!
no ip http server
no ip http secure-server
!
! =============================
! Users & AAA
! =============================
username admin privilege 15 secret 9 $9$examplehashedpassword
!
aaa new-model
!
aaa group server tacacs+ TACACS-SERVERS
 server 10.10.10.10
 server 10.10.10.11
 timeout 5
!
aaa authentication login default group TACACS-SERVERS local
aaa authorization exec default group TACACS-SERVERS local
aaa authorization commands 15 default group TACACS-SERVERS local
aaa accounting exec default start-stop group TACACS-SERVERS
!
tacacs server TACACS1
 address ipv4 10.10.10.10
 key 7 070C285F4D06
!
tacacs server TACACS2
 address ipv4 10.10.10.11
 key 7 070C285F4D06
!
! =============================
! VRFs
! =============================
vrf definition MGMT
 address-family ipv4
 exit-address-family
!
vrf definition CUST-A
 rd 65001:100
 address-family ipv4
 exit-address-family
!
vrf definition CUST-B
 rd 65001:200
 address-family ipv4
 exit-address-family
!
! =============================
! Management Interface
! =============================
interface GigabitEthernet0/0
 description OOB Management
 vrf forwarding MGMT
 ip address 192.168.10.20 255.255.255.0
 no shutdown
!
ip route vrf MGMT 0.0.0.0 0.0.0.0 192.168.10.1
!
! =============================
! Loopbacks
! =============================
interface Loopback0
 description Router-ID
 ip address 10.255.255.2 255.255.255.255
!
interface Loopback100
 description Services Loopback
 ip address 10.255.255.200 255.255.255.255
!
! =============================
! Core / WAN Interfaces
! =============================
interface GigabitEthernet0/1
 description ISP-PRIMARY
 mtu 9216
 ip address 172.16.11.2 255.255.255.252
 no shutdown
!
interface GigabitEthernet0/2
 description ISP-BACKUP
 mtu 9216
 ip address 172.16.12.2 255.255.255.252
 no shutdown
!
! =============================
! Customer Access Interfaces
! =============================
interface GigabitEthernet0/3
 description Customer-A-Access
 vrf forwarding CUST-A
 ip address 192.168.201.1 255.255.255.0
 no shutdown
!
interface GigabitEthernet0/4
 description Customer-B-Access
 vrf forwarding CUST-B
 ip address 192.168.202.1 255.255.255.0
 no shutdown
!
! =============================
! Subinterfaces (802.1Q)
! =============================
interface GigabitEthernet0/5.100
 description VLAN100-CUST-A
 encapsulation dot1Q 100
 vrf forwarding CUST-A
 ip address 10.20.100.1 255.255.255.0
!
interface GigabitEthernet0/5.200
 description VLAN200-CUST-B
 encapsulation dot1Q 200
 vrf forwarding CUST-B
 ip address 10.20.200.1 255.255.255.0
!
! =============================
! OSPF – Core IGP
! =============================
router ospf 100
 router-id 10.255.255.2
 passive-interface default
 no passive-interface GigabitEthernet0/1
 no passive-interface GigabitEthernet0/2
 network 10.255.255.2 0.0.0.0 area 0
 network 172.16.11.0 0.0.0.3 area 0
 network 172.16.12.0 0.0.0.3 area 0
!
! =============================
! BGP – Internet + VRFs
! =============================
router bgp 65001
 bgp router-id 10.255.255.2
 bgp log-neighbor-changes
!
 neighbor 172.16.11.1 remote-as 65010
 neighbor 172.16.11.1 description ISP-PRIMARY
 neighbor 172.16.11.1 route-map ISP-IN in
 neighbor 172.16.11.1 route-map ISP-OUT out
!
 neighbor 172.16.12.1 remote-as 65020
 neighbor 172.16.12.1 description ISP-BACKUP
 neighbor 172.16.12.1 route-map ISP-IN in
 neighbor 172.16.12.1 route-map ISP-OUT out
!
 address-family ipv4
  network 10.255.255.2 mask 255.255.255.255
 exit-address-family
!
 address-family ipv4 vrf CUST-A
  neighbor 10.20.100.2 remote-as 65100
  network 192.168.201.0 mask 255.255.255.0
 exit-address-family
!
 address-family ipv4 vrf CUST-B
  network 192.168.202.0 mask 255.255.255.0
 exit-address-family
!
! =============================
! Route Maps (IOS style)
! =============================
route-map ISP-IN permit 10
!
route-map ISP-OUT permit 10
 match ip address prefix-list EXPORT-PREFIX
!
ip prefix-list EXPORT-PREFIX seq 5 permit 10.255.255.0/24
!
! =============================
! QoS
! =============================
policy-map QOS-CUST
 class class-default
  bandwidth percent 50
!
interface GigabitEthernet0/3
 service-policy output QOS-CUST
!
! =============================
! NTP
! =============================
ntp server 192.168.100.10 prefer
ntp server 192.168.100.11
!
! =============================
! Syslog
! =============================
logging host 192.168.200.20
logging trap informational
logging buffered 200000
!
! =============================
! SNMP
! =============================
snmp-server community PROD-RO RO
snmp-server location DC-Bangalore
snmp-server contact noc@example.net
!
! =============================
! NetFlow (IOS-specific, very prod)
! =============================
ip flow-export destination 192.168.60.10 2055
ip flow-export version 9
!
interface GigabitEthernet0/1
 ip flow ingress
 ip flow egress
!
! =============================
! SSH Hardening
! =============================
ip ssh version 2
ip ssh time-out 60
ip ssh authentication-retries 3
!
line vty 0 4
 transport input ssh
 login authentication default
!
! =============================
! Control Plane Protection
! =============================
control-plane
 service-policy input COPP-POLICY
!
policy-map COPP-POLICY
 class class-default
  police 64000 conform-action transmit exceed-action drop
!
! =============================
! Save
! =============================
end
write memory
